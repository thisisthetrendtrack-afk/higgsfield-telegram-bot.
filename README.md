# Telegram DoP Bot with Higgsfield API

This project implements an asynchronous Telegram bot that uses the
Higgsfield DoP (Directors of Photography) model to convert a static
image into a short cinematic video. Users upload a photo, send a text
prompt describing the desired motion, and receive a generated video when
the job finishes. The bot is designed to run seamlessly on
Railway.app using a Dockerfile‑based deployment.

## Features

- **Image to Video Generation** – Users can generate a DoP video by
  uploading an image and providing a prompt. The bot handles job
  creation, status polling and sending back the finished video.
- **Command Menu** – The bot registers commands with Telegram so users
  can access `/start`, `/help`, `/image2video`, `/status`, `/speak`,
  `/soul`, `/motions`, `/characters` and `/delete_character`. Only
  the image‑to‑video workflow is implemented; the remaining commands
  are placeholders for future features.
- **Error Handling** – Network failures and unexpected API responses are
  logged and reported to the user rather than crashing the bot.

## Prerequisites

- Python 3.11 or newer.
- A Telegram bot token obtained from [@BotFather](https://t.me/BotFather).
- Higgsfield API credentials (key and secret). These can be created
  through your Higgsfield account. Without valid credentials the bot
  cannot access the DoP API.

## Local Development

1. **Clone the repository** and navigate into its directory.

2. **Create a `.env` file** at the project root with the following
   variables:

   ```env
   TELEGRAM_TOKEN=your-telegram-bot-token
   HF_KEY=your-higgsfield-key
   HF_SECRET=your-higgsfield-secret
   ```

3. **Install dependencies**:

   ```bash
   pip install -r requirements.txt
   ```

4. **Run the bot**:

   ```bash
   python main.py
   ```

   The bot will start polling Telegram for updates. You can test the
   workflow by sending `/image2video`, uploading a photo and then
   sending a prompt.

## Deployment on Railway

Follow these steps to deploy the bot to Railway. You will need a free
Railway account and the bot’s source code hosted in a GitHub
repository.

1. **Push your code to GitHub.** Commit all files in this project to a
   Git repository and push it to GitHub.

2. **Create a new Railway project.** Log into Railway and click
   **“New Project”**. Choose **Deploy from GitHub** and select the
   repository containing this bot.

3. **Configure environment variables.** Once the project is created,
   navigate to the **Variables** tab. Add the following variables:

   - `TELEGRAM_TOKEN` – your Telegram bot token.
   - `HF_KEY` – your Higgsfield API key.
   - `HF_SECRET` – your Higgsfield API secret.

   Railway will inject these values into the container at runtime. You
   should never commit sensitive tokens to version control.

4. **Deploy the service.** Railway detects the `Dockerfile` in the
   repository and builds the image automatically. The included
   `railway.json` specifies that Railway should use the Dockerfile
   builder and start the bot with `python main.py`. Click **Deploy** to
   start a new deployment.

5. **Monitor the logs.** After the build completes, open the **Logs**
   tab to ensure the bot starts without errors. You should see log
   messages indicating the bot is running and waiting for updates.

6. **Test the bot.** Open a chat with your bot on Telegram and send
   `/start`. Then follow the instructions: upload a photo and send a
   prompt. Within a few moments you should receive a video generated by
   Higgsfield’s DoP model.

### Updating and Redeploying

Whenever you commit changes to the GitHub repository, Railway will
automatically build and deploy a new version of your bot. You can
monitor builds and deployments from the Railway dashboard. Environment
variables can be updated via the **Variables** tab without changing the
code.

## File Overview

- **`main.py`** – Asynchronous entry point. Loads environment
  variables, configures the Telegram application and registers all
  handlers.
- **`bot.py`** – Contains all Telegram handlers. Implements the
  image‑to‑video workflow and placeholder commands.
- **`higgsfield_api.py`** – Minimal wrapper for Higgsfield’s REST API.
  Provides job creation and status polling.
- **`utils.py`** – Logging setup and helper for retrieving image URLs
  from Telegram.
- **`requirements.txt`** – Python dependencies used by the project.
- **`Dockerfile`** – Defines a lightweight Python 3.11 image for the
  bot. Railway uses this for production builds.
- **`railway.json`** – Configures Railway to use the Dockerfile builder
  and specifies the command to start the bot.

## Troubleshooting

- **Bot doesn’t respond to commands:** Verify that your `TELEGRAM_TOKEN`
  is correct and that the bot is not blocked. You can message
  [@BotFather](https://t.me/BotFather) to ensure the token is valid.
- **Jobs never complete or fail immediately:** Check your Higgsfield
  credentials. An invalid `HF_KEY` or `HF_SECRET` will cause all API
  requests to fail. Also ensure the image you upload is publicly
  reachable via the URL returned by Telegram.
- **Deployment fails on Railway:** Inspect the build logs. Ensure
  Railway is using the Dockerfile builder (this is specified in
  `railway.json`) and that all environment variables are set. The bot
  requires internet access to communicate with Telegram and Higgsfield.