    # --- Sora simple flow: waiting_prompt ---
    if session.get("mode") == "sora" and session.get("step") == "waiting_prompt":
        if not check_limit(chat_id):
            daily_limit = get_user_daily_limit(chat_id)
            await update.message.reply_text(
                f"‚ùå Daily Limit Reached\n"
                f"You've used all {daily_limit} generations today.\n\n"
                f"Use `/redeem KEY` to get more generations",
                parse_mode="Markdown"
            )
            return
        status_msg = await update.message.reply_text("‚è≥ Generating Sora video (1280x720)... This can take a while.")
        try:
            # --- ADMIN: log start of Sora job ---
            try:
                if LOG_VERBOSE:
                    await context.bot.send_message(
                        chat_id=ADMIN_ID,
                        text=(
                            f"üü¶ Sora job started\n"
                            f"üë§ {update.message.from_user.first_name} (`{chat_id}`)\n"
                            f"üîé Mode: Sora\n"
                            f"‚è± Duration: 4s  Size: 1280x720\n"
                            f"üìù Prompt (trim): {text[:800]}"
                        ),
                        parse_mode="Markdown"
                    )
            except:
                pass

            loop = asyncio.get_event_loop()
            # default Sora size set to 1280x720 (16:9)
            result = await loop.run_in_executor(None, generate_sora_video, text, 4, "1280x720")
            if isinstance(result, tuple):
                video_bytes, final_url = result
            else:
                video_bytes = result
                final_url = None

            if not video_bytes:
                raise ValueError("No video bytes received from Sora")

            import io, os as _os, tempfile
            tf = tempfile.NamedTemporaryFile(delete=False, suffix=".mp4")
            try:
                tf.write(video_bytes)
                tf.flush()
                tf.close()
                filesize = _os.path.getsize(tf.name)

                # --- ADMIN: log success with filesize & url ---
                try:
                    if LOG_VERBOSE:
                        admin_msg = f"üü© Sora job completed\nüë§ {update.message.from_user.first_name} (`{chat_id}`)\nFilesize: {filesize} bytes"
                        if final_url:
                            admin_msg += f"\nURL: {final_url}"
                        await context.bot.send_message(chat_id=ADMIN_ID, text=admin_msg)
                except:
                    pass

                try:
                    if filesize <= 50 * 1024 * 1024:  # 50 MB threshold
                        await update.message.reply_video(open(tf.name, "rb"), caption="üé¨ Generated by Sora")
                    else:
                        await update.message.reply_document(open(tf.name, "rb"), caption="üé¨ Generated by Sora (document)")
                except Exception as send_err:
                    # If sending fails, at least provide the final URL if present
                    try:
                        if final_url:
                            await update.message.reply_text(f"‚úÖ Video ready but sending failed. Download here: {final_url}")
                        else:
                            await update.message.reply_text(f"‚úÖ Video ready but sending failed. Error: {send_err}")
                    except:
                        pass

                increment_usage(chat_id)
            finally:
                try:
                    _os.unlink(tf.name)
                except:
                    pass

            try:
                await context.bot.delete_message(chat_id=chat_id, message_id=status_msg.message_id)
            except:
                pass
            return
        except SoraError as se:
            try:
                await context.bot.delete_message(chat_id=chat_id, message_id=status_msg.message_id)
            except:
                pass
            # ADMIN: send error to admin
            try:
                await context.bot.send_message(chat_id=ADMIN_ID, text=f"üõë Sora error for `{chat_id}`: {se}")
            except:
                pass
            await update.message.reply_text(f"‚ùå Sora error: {se}")
            return
        except Exception as e:
            try:
                await context.bot.delete_message(chat_id=chat_id, message_id=status_msg.message_id)
            except:
                pass
            try:
                await context.bot.send_message(chat_id=ADMIN_ID, text=f"üõë Unexpected Sora error for `{chat_id}`: {e}")
            except:
                pass
            await update.message.reply_text(f"‚ùå Unexpected Sora error: {e}")
            return
